import{IndexedDBWrapper}from"../indexedDB/IndexedDBWrapper.js";import{Router,ROUTES}from"../utils/Router.js";const MEDIA_TYPE={IMAGE:0,VIDEO:1};class MediaItem extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._file=null,this._media=MEDIA_TYPE.IMAGE}render(){this.shadowRoot.innerHTML='<style>\n                                    .container {\n                                        display: flex;\n                                        width: 300px;\n                                        height: auto;\n                                    }\n                                    .media-wrapper {\n                                        // align-self: stretch;\n                                    }\n                                    .media-wrapper > img {\n                                        opacity: 1;\n                                        border-color: #e0fbfc;\n                                        border-width: 5px;\n                                        border-radius: 20px;\n                                        box-shadow: 20px 20px 5px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);\n                                        height: auto;\n                                        width: 100%;\n                                        display:inline-block;\n                                    }\n                                    .media-wrapper > img:hover {\n                                      opacity: 0.8;\n                                    }\n                                    .media-wrapper > video {\n                                      \n                                        border-color: #e0fbfc;\n                                        border-width: 5px;\n                                        border-radius: 20px;\n                                        box-shadow: 20px 20px 20px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);\n                                        height: auto;\n                                        width: 100%;\n                                        display:inline-block;\n                                    }\n                                    button {\n                                        background-color:white;\n                                        border-radius: 200px;\n                                        border-style: solid;\n                                        border-color:#EE6C4D;\n                                        padding:0;\n                                        font-size: inherit;\n                                        width: 3rem;\n                                        height: 3rem;\n                                        margin: auto;\n                                        visibility: hidden\n                                    }\n                                    button:hover {\n                                      visibility: visible;\n                                      cursor: pointer;\n                                    }\n                                    .icon {\n                                        background-size: contain;\n                                        display: inline-block;\n                                        width: 50%;\n                                        height: 50%;\n                                        margin: auto;\n                                    }\n                                    .trash-button-icon {\n                                        background: url(./images/log-item_icons/trash-solid.svg) no-repeat center center;\n                                    }\n                                    </style>\n                                    <span class="container">\n                                        <span class="media-wrapper">\n                                            <button type="button">\n                                            <span class="icon trash-button-icon"></span>\n                                            </button>\n                                        </span>\n                                    </span>';this.shadowRoot.querySelector(".media-wrapper").appendChild(this.getMedia());const e=this;this.shadowRoot.querySelector("button").addEventListener("click",(t=>{new IndexedDBWrapper("experimentalDB",1).transaction((t=>{t.target.result.transaction(["currentLogStore"],"readwrite").objectStore("currentLogStore").openCursor().onsuccess=function(t){const n=t.target.result;if(n){const t=(new Router).url.searchParams.get("name").replace(/\+/g," "),i=n.value.properties.collections.find((e=>e.name===t));let r;r=e._media===MEDIA_TYPE.IMAGE?i.images:i.videos,r=r.filter(((t,n)=>t.file.name!==e._file.name)),e._media===MEDIA_TYPE.IMAGE?i.images=r:i.videos=r,n.update(n.value)}}})),t.target.parentElement.parentElement.remove()})),this.setHoverListeners()}setHoverListeners(){const e=this.shadowRoot.querySelector("button");this.addEventListener("mouseenter",(()=>{e.style.visibility="visible"})),this.addEventListener("mouseleave",(()=>{e.style.visibility="hidden"}))}set file(e){this._file=e,this.render()}get file(){return this._file}set media(e){this._media=e,this.render()}get media(){return this._media}getMedia(){let e;this._media===MEDIA_TYPE.IMAGE?e=document.createElement("img"):(e=document.createElement("video"),e.controls=!0),e.file=this._file;const t=new FileReader;return t.onload=t=>{e.src=t.target.result},t.readAsDataURL(this._file),e}}customElements.define("media-item",MediaItem);export{MediaItem,MEDIA_TYPE};