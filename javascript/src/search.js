import{IndexedDBWrapper}from"./indexedDB/IndexedDBWrapper.js";const searchResults=document.getElementById("search-results"),resultsHeader=document.querySelector("#result-container > h2");function getLogInfoAsJSON(e,t){new IndexedDBWrapper("experimentalDB",1).transaction((n=>{n.target.result.transaction(["currentLogStore"],"readonly").objectStore("currentLogStore").openCursor().onsuccess=function(n){const r=n.target.result;if(r){const n={isCaseSensitive:!1,includeScore:!1,shouldSort:!0,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.4,distance:10,useExtendedSearch:!1,ignoreLocation:!0,ignoreFieldNorm:!1};let s=0;if("daily-logs"===t){let t,o,c,i;n.keys=["description"],r.value.$defs["daily-logs"].forEach(((r,l)=>{if(t=searchByEntry(e,r.properties.tasks,n),o=searchByEntry(e,r.properties.notes,n),c=searchByEntry(e,r.properties.events,n),i=searchByEntry(e,r.properties.reflection,n),t.length>0||o.length>0||c.length>0||i.length>0){const e=document.createElement("search-item"),n=document.createElement("li");e.entry={time:Number(r.properties.date.time),tasks:t,notes:o,events:c,reflection:i,type:"daily-log"},n.appendChild(e),searchResults.appendChild(n),s++}console.log()}))}else{let t;n.keys=["description"],r.value.properties.collections.forEach(((r,o)=>{if(t=searchByEntry(e,r.tasks,n),t.length>0){const e=document.createElement("search-item"),n=document.createElement("li");e.entry={name:r.name,tasks:t,type:"collection"},n.appendChild(e),searchResults.appendChild(n),s++}}))}resultsHeader.textContent=`Search results: ${s} entries found`}}}))}function searchByEntry(e,t,n){return new Fuse(t,n).search(e)}const searchButton=document.getElementById("search"),inputField=document.getElementById("input-area"),radioDailyLog=document.getElementById("input1"),radioCollection=document.getElementById("input2"),resultContainer=document.getElementById("result-container");document.addEventListener("DOMContentLoaded",(e=>{searchButton.addEventListener("click",(e=>{document.getElementById("search-results").innerHTML="",getLogInfoAsJSON(inputField.value,radioDailyLog.checked?"daily-logs":"collections"),resultContainer.style.visibility="visible"}))}));