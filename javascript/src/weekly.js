import{IndexedDBWrapper}from"./indexedDB/IndexedDBWrapper.js";import{DateConverter}from"./utils/DateConverter.js";import{Router,ROUTES}from"./utils/Router.js";const weekly=document.getElementById("weekly-div"),monday=document.getElementById("Monday"),tuesday=document.getElementById("Tuesday"),wednesday=document.getElementById("Wednesday"),thursday=document.getElementById("Thursday"),friday=document.getElementById("Friday"),saturday=document.getElementById("Saturday"),sunday=document.getElementById("Sunday");function getLogInfoAsJSON(e){new IndexedDBWrapper("experimentalDB",1).transaction((t=>{const n=t.target.result.transaction(["currentLogStore"],"readonly").objectStore("currentLogStore"),o=n.getAll();o.onsuccess=e=>{o.result},n.openCursor().onsuccess=function(t){const n=t.target.result;if(n){const t=(new Router).url.searchParams,o=Number(t.get("year")),r=Number(t.get("month"))-1;t.get("displayFirstOfMonth");let a,s;const d=n.value.$defs["daily-logs"];let m;if(t.has("displayFirstOfMonth")){s=d.filter((e=>{const t=Number(e.properties.date.time),n=new Date(t);return n.getFullYear()===o&&n.getMonth()===r}));const e=[];s.forEach((t=>{const n=Number(t.properties.date.time);e.push(n)}));const t=Math.min(...e);a=new DateConverter(t),m=d.filter((e=>{const t=e.properties.date.time;return a.oldTimestampInSameWeek(Number(t))}))}else a=new DateConverter,m=d.filter((e=>{const t=e.properties.date.time;return a.timestampsInSameWeek(Number(t))}));e(m,a)}}}))}function populateWeeklyView(e,t){addColumnDates(t),populateDayColumns(e,t)}function populateDayColumns(e,t){const n=document.getElementById("weekly-div"),o=(t.getDay()+6)%7;e.forEach((e=>{const r=new DateConverter(Number(e.properties.date.time)),a=t.getDaysFromTimeStamp()-r.getDaysFromTimeStamp(),s=o-a,d=document.createElement("weekly-view-item");d.entry=e;const m=n.children[s];appendNavLinks(m,r),m.appendChild(d)}))}function appendNavLinks(e,t){e.querySelector("a").onclick=function(e){e.preventDefault();const n=new URLSearchParams;n.append("timestamp",t.getTime());const o=new URL(ROUTES.daily,location.origin);o.search=n,new Router(o).navigate()}}function addColumnDates(e){const t=e.getBeginningOfWeek(),n=document.getElementById("weekly-div").getElementsByTagName("div");for(let e=0;e<n.length;e++){const o=n[e].querySelector("a"),r=new DateConverter(t+864e5*e),a=`(${r.getMonth()+1}.${r.getDate()})`;o.textContent=`${o.textContent} ${a}`}}document.addEventListener("DOMContentLoaded",(e=>{getLogInfoAsJSON(populateWeeklyView)}));